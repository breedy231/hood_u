'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

exports.requestFile = requestFile;

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

// Supports loading (requesting) assets with XHR (XmlHttpRequest)
/* eslint-disable guard-for-in, complexity, no-try-catch */

/* global XMLHttpRequest */
function noop() {}

var XHR_STATES = {
  UNINITIALIZED: 0,
  LOADING: 1,
  LOADED: 2,
  INTERACTIVE: 3,
  COMPLETED: 4
};

var XHR = function () {
  function XHR(_ref) {
    var url = _ref.url,
        _ref$path = _ref.path,
        path = _ref$path === undefined ? null : _ref$path,
        _ref$method = _ref.method,
        method = _ref$method === undefined ? 'GET' : _ref$method,
        _ref$asynchronous = _ref.asynchronous,
        asynchronous = _ref$asynchronous === undefined ? true : _ref$asynchronous,
        _ref$noCache = _ref.noCache,
        noCache = _ref$noCache === undefined ? false : _ref$noCache,
        _ref$sendAsBinary = _ref.sendAsBinary,
        sendAsBinary = _ref$sendAsBinary === undefined ? false : _ref$sendAsBinary,
        _ref$responseType = _ref.responseType,
        responseType = _ref$responseType === undefined ? false : _ref$responseType,
        _ref$onProgress = _ref.onProgress,
        onProgress = _ref$onProgress === undefined ? noop : _ref$onProgress,
        _ref$onError = _ref.onError,
        onError = _ref$onError === undefined ? noop : _ref$onError,
        _ref$onAbort = _ref.onAbort,
        onAbort = _ref$onAbort === undefined ? noop : _ref$onAbort,
        _ref$onComplete = _ref.onComplete,
        onComplete = _ref$onComplete === undefined ? noop : _ref$onComplete;

    _classCallCheck(this, XHR);

    this.url = path ? path.join(path, url) : url;
    this.method = method;
    this.async = asynchronous;
    this.noCache = noCache;
    this.sendAsBinary = sendAsBinary;
    this.responseType = responseType;

    this.req = new XMLHttpRequest();

    this.req.onload = function (e) {
      return onComplete(e);
    };
    this.req.onerror = function (e) {
      return onError(e);
    };
    this.req.onabort = function (e) {
      return onAbort(e);
    };
    this.req.onprogress = function (e) {
      if (e.lengthComputable) {
        onProgress(e, Math.round(e.loaded / e.total * 100));
      } else {
        onProgress(e, -1);
      }
    };
  }

  _createClass(XHR, [{
    key: 'setRequestHeader',
    value: function setRequestHeader(header, value) {
      this.req.setRequestHeader(header, value);
      return this;
    }

    // /* eslint-disable max-statements */

  }, {
    key: 'sendAsync',
    value: function sendAsync() {
      var _this = this;

      var body = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.body || null;

      return new Promise(function (resolve, reject) {
        try {
          var req = _this.req,
              method = _this.method,
              noCache = _this.noCache,
              sendAsBinary = _this.sendAsBinary,
              responseType = _this.responseType;


          var url = noCache ? _this.url + (_this.url.indexOf('?') >= 0 ? '&' : '?') + Date.now() : _this.url;

          req.open(method, url, _this.async);

          if (responseType) {
            req.responseType = responseType;
          }

          if (_this.async) {
            req.onreadystatechange = function (e) {
              if (req.readyState === XHR_STATES.COMPLETED) {
                if (req.status === 200) {
                  resolve(req.responseType ? req.response : req.responseText);
                } else {
                  reject(new Error(req.status + ': ' + url));
                }
              }
            };
          }

          if (sendAsBinary) {
            req.sendAsBinary(body);
          } else {
            req.send(body);
          }

          if (!_this.async) {
            if (req.status === 200) {
              resolve(req.responseType ? req.response : req.responseText);
            } else {
              reject(new Error(req.status + ': ' + url));
            }
          }
        } catch (error) {
          reject(error);
        }
      });
    }
    /* eslint-enable max-statements */

  }]);

  return XHR;
}();

function requestFile(opts) {
  var xhr = new XHR(opts);
  return xhr.sendAsync();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9pby9icm93c2VyLXJlcXVlc3QtZmlsZS5qcyJdLCJuYW1lcyI6WyJyZXF1ZXN0RmlsZSIsIm5vb3AiLCJYSFJfU1RBVEVTIiwiVU5JTklUSUFMSVpFRCIsIkxPQURJTkciLCJMT0FERUQiLCJJTlRFUkFDVElWRSIsIkNPTVBMRVRFRCIsIlhIUiIsInVybCIsInBhdGgiLCJtZXRob2QiLCJhc3luY2hyb25vdXMiLCJub0NhY2hlIiwic2VuZEFzQmluYXJ5IiwicmVzcG9uc2VUeXBlIiwib25Qcm9ncmVzcyIsIm9uRXJyb3IiLCJvbkFib3J0Iiwib25Db21wbGV0ZSIsImpvaW4iLCJhc3luYyIsInJlcSIsIlhNTEh0dHBSZXF1ZXN0Iiwib25sb2FkIiwiZSIsIm9uZXJyb3IiLCJvbmFib3J0Iiwib25wcm9ncmVzcyIsImxlbmd0aENvbXB1dGFibGUiLCJNYXRoIiwicm91bmQiLCJsb2FkZWQiLCJ0b3RhbCIsImhlYWRlciIsInZhbHVlIiwic2V0UmVxdWVzdEhlYWRlciIsImJvZHkiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImluZGV4T2YiLCJEYXRlIiwibm93Iiwib3BlbiIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJyZXNwb25zZSIsInJlc3BvbnNlVGV4dCIsIkVycm9yIiwic2VuZCIsImVycm9yIiwib3B0cyIsInhociIsInNlbmRBc3luYyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7UUF3R2dCQSxXLEdBQUFBLFc7Ozs7QUF4R2hCO0FBQ0E7O0FBRUE7QUFDQSxTQUFTQyxJQUFULEdBQWdCLENBQUU7O0FBRWxCLElBQU1DLGFBQWE7QUFDakJDLGlCQUFlLENBREU7QUFFakJDLFdBQVMsQ0FGUTtBQUdqQkMsVUFBUSxDQUhTO0FBSWpCQyxlQUFhLENBSkk7QUFLakJDLGFBQVc7QUFMTSxDQUFuQjs7SUFRTUMsRztBQUNKLHFCQWFHO0FBQUEsUUFaREMsR0FZQyxRQVpEQSxHQVlDO0FBQUEs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cyIsInNvdXJjZXNDb250ZW50IjpbIi8vIFN1cHBvcnRzIGxvYWRpbmcgKHJlcXVlc3RpbmcpIGFzc2V0cyB3aXRoIFhIUiAoWG1sSHR0cFJlcXVlc3QpXG4vKiBlc2xpbnQtZGlzYWJsZSBndWFyZC1mb3ItaW4sIGNvbXBsZXhpdHksIG5vLXRyeS1jYXRjaCAqL1xuXG4vKiBnbG9iYWwgWE1MSHR0cFJlcXVlc3QgKi9cbmZ1bmN0aW9uIG5vb3AoKSB7fVxuXG5jb25zdCBYSFJfU1RBVEVTID0ge1xuICBVTklOSVRJQUxJWkVEOiAwLFxuICBMT0FESU5HOiAxLFxuICBMT0FERUQ6IDIsXG4gIElOVEVSQUNUSVZFOiAzLFxuICBDT01QTEVURUQ6IDRcbn07XG5cbmNsYXNzIFhIUiB7XG4gIGNvbnN0cnVjdG9yKHtcbiAgICB1cmwsXG4gICAgcGF0aCA9IG51bGwsXG4gICAgbWV0aG9kID0gJ0dFVCcsXG4gICAgYXN5bmNocm9ub3VzID0gdHJ1ZSxcbiAgICBub0NhY2hlID0gZmFsc2UsXG4gICAgLy8gYm9keSA9IG51bGwsXG4gICAgc2VuZEFzQmluYXJ5ID0gZmFsc2UsXG4gICAgcmVzcG9uc2VUeXBlID0gZmFsc2UsXG4gICAgb25Qcm9ncmVzcyA9IG5vb3AsXG4gICAgb25FcnJvciA9IG5vb3AsXG4gICAgb25BYm9ydCA9IG5vb3AsXG4gICAgb25Db21wbGV0ZSA9IG5vb3BcbiAgfSkge1xuICAgIHRoaXMudXJsID0gcGF0aCA/IHBhdGguam9pbihwYXRoLCB1cmwpIDogdXJsO1xuICAgIHRoaXMubWV0aG9kID0gbWV0aG9kO1xuICAgIHRoaXMuYXN5bmMgPSBhc3luY2hyb25vdXM7XG4gICAgdGhpcy5ub0NhY2hlID0gbm9DYWNoZTtcbiAgICB0aGlzLnNlbmRBc0JpbmFyeSA9IHNlbmRBc0JpbmFyeTtcbiAgICB0aGlzLnJlc3BvbnNlVHlwZSA9IHJlc3BvbnNlVHlwZTtcblxuICAgIHRoaXMucmVxID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgICB0aGlzLnJlcS5vbmxvYWQgPSBlID0+IG9uQ29tcGxldGUoZSk7XG4gICAgdGhpcy5yZXEub25lcnJvciA9IGUgPT4gb25FcnJvcihlKTtcbiAgICB0aGlzLnJlcS5vbmFib3J0ID0gZSA9PiBvbkFib3J0KGUpO1xuICAgIHRoaXMucmVxLm9ucHJvZ3Jlc3MgPSBlID0+IHtcbiAgICAgIGlmIChlLmxlbmd0aENvbXB1dGFibGUpIHtcbiAgICAgICAgb25Qcm9ncmVzcyhlLCBNYXRoLnJvdW5kKGUubG9hZGVkIC8gZS50b3RhbCAqIDEwMCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb25Qcm9ncmVzcyhlLCAtMSk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIHNldFJlcXVlc3RIZWFkZXIoaGVhZGVyLCB2YWx1ZSkge1xuICAgIHRoaXMucmVxLnNldFJlcXVlc3RIZWFkZXIoaGVhZGVyLCB2YWx1ZSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvLyAvKiBlc2xpbnQtZGlzYWJsZSBtYXgtc3RhdGVtZW50cyAqL1xuICBzZW5kQXN5bmMoYm9keSA9IHRoaXMuYm9keSB8fCBudWxsKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHtyZXEsIG1ldGhvZCwgbm9DYWNoZSwgc2VuZEFzQmluYXJ5LCByZXNwb25zZVR5cGV9ID0gdGhpcztcblxuICAgICAgICBjb25zdCB1cmwgPSBub0NhY2hlID9cbiAgICAgICAgICB0aGlzLnVybCArICh0aGlzLnVybC5pbmRleE9mKCc/JykgPj0gMCA/ICcmJyA6ICc/JykgKyBEYXRlLm5vdygpIDpcbiAgICAgICAgICB0aGlzLnVybDtcblxuICAgICAgICByZXEub3BlbihtZXRob2QsIHVybCwgdGhpcy5hc3luYyk7XG5cbiAgICAgICAgaWYgKHJlc3BvbnNlVHlwZSkge1xuICAgICAgICAgIHJlcS5yZXNwb25zZVR5cGUgPSByZXNwb25zZVR5cGU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5hc3luYykge1xuICAgICAgICAgIHJlcS5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBlID0+IHtcbiAgICAgICAgICAgIGlmIChyZXEucmVhZHlTdGF0ZSA9PT0gWEhSX1NUQVRFUy5DT01QTEVURUQpIHtcbiAgICAgICAgICAgICAgaWYgKHJlcS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHJlc29sdmUocmVxLnJlc3BvbnNlVHlwZSA/IHJlcS5yZXNwb25zZSA6IHJlcS5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoYCR7cmVxLnN0YXR1c306ICR7dXJsfWApKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoc2VuZEFzQmluYXJ5KSB7XG4gICAgICAgICAgcmVxLnNlbmRBc0JpbmFyeShib2R5KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXEuc2VuZChib2R5KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5hc3luYykge1xuICAgICAgICAgIGlmIChyZXEuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgIHJlc29sdmUocmVxLnJlc3BvbnNlVHlwZSA/IHJlcS5yZXNwb25zZSA6IHJlcS5yZXNwb25zZVRleHQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZWplY3QobmV3IEVycm9yKGAke3JlcS5zdGF0dXN9OiAke3VybH1gKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIC8qIGVzbGludC1lbmFibGUgbWF4LXN0YXRlbWVudHMgKi9cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlcXVlc3RGaWxlKG9wdHMpIHtcbiAgY29uc3QgeGhyID0gbmV3IFhIUihvcHRzKTtcbiAgcmV0dXJuIHhoci5zZW5kQXN5bmMoKTtcbn1cbiJdfQ==